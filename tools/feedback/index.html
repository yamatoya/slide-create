<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slide Feedback</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: { 700: '#1B4565', 800: '#15374d' },
            teal: { 500: '#3E9BA4', 600: '#358a92' }
          }
        }
      }
    }
  </script>
  <style>
    .pattern-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .pattern-card.selected { ring: 2px solid #3E9BA4; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="bg-navy-700 text-white px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <h1 class="font-bold">Slide Feedback</h1>
      <select id="slideSelect" class="bg-navy-800 text-white px-3 py-1 rounded text-sm">
        <option value="go-conference-2026/slide.md">go-conference-2026</option>
        <option value="internal-study-202602/slide.md">internal-study-202602</option>
      </select>
    </div>
    <div class="flex items-center gap-2">
      <button onclick="prevSlide()" class="bg-navy-800 hover:bg-gray-600 px-3 py-1 rounded">â†</button>
      <span id="slideCounter" class="text-sm min-w-[120px] text-center">ã‚¹ãƒ©ã‚¤ãƒ‰ 1 / 29</span>
      <button onclick="nextSlide()" class="bg-navy-800 hover:bg-gray-600 px-3 py-1 rounded">â†’</button>
      <button onclick="openInNewTab()" class="bg-navy-800 hover:bg-gray-600 px-3 py-1 rounded text-sm ml-4">æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</button>
      <button onclick="toggleFullscreen()" class="bg-navy-800 hover:bg-gray-600 px-3 py-1 rounded text-sm">ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
      <button onclick="toggleCommentPanel()" class="bg-teal-500 hover:bg-teal-600 px-3 py-1 rounded text-sm flex items-center gap-1">
        <span>â—</span>ã‚³ãƒ¡ãƒ³ãƒˆ
      </button>
    </div>
  </header>

  <div class="flex h-[calc(100vh-56px)]">
    <!-- ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div id="previewArea" class="flex-1 bg-gray-800 p-4 flex items-center justify-center">
      <iframe id="slideFrame" class="bg-white shadow-2xl" style="width: 960px; height: 540px; border: none;"></iframe>
    </div>

    <!-- ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ« -->
    <div id="commentPanel" class="w-80 bg-white border-l border-gray-200 flex flex-col">
      <div class="p-4 border-b border-gray-200">
        <h2 class="font-bold text-gray-800">ä¿®æ­£æŒ‡ç¤º</h2>
        <p id="slideTitle" class="text-sm text-gray-500 mt-1">ã‚¹ãƒ©ã‚¤ãƒ‰ 1: ã‚¿ã‚¤ãƒˆãƒ«</p>
      </div>

      <!-- ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ -->
      <div class="p-4 border-b border-gray-200">
        <label class="text-sm text-gray-600">ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ</label>
        <div id="currentSlideComments" class="mt-2 space-y-2">
          <!-- ã‚³ãƒ¡ãƒ³ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
      </div>

      <!-- æ–°ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ› -->
      <div class="p-4 border-b border-gray-200 flex-1 overflow-auto">
        <textarea id="newComment" class="w-full h-24 border border-gray-300 rounded p-2 text-sm resize-none" placeholder="æ–°ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ..."></textarea>

        <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="mt-3 flex flex-wrap gap-2">
          <button onclick="insertQuickAction('style')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-xs">ã‚¹ã‚¿ã‚¤ãƒ«æ•´å½¢</button>
          <button onclick="insertQuickAction('layout')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-xs">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£</button>
          <button onclick="openLayoutModal()" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-xs">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¾‹æŒ‡å®š</button>
          <button onclick="insertQuickAction('illustration')" class="px-2 py-1 bg-yellow-100 hover:bg-yellow-200 rounded text-xs flex items-center gap-1">
            <span>ğŸ¨</span>èª¬æ˜ã‚¤ãƒ©ã‚¹ãƒˆä½œæˆ
          </button>
          <button onclick="insertQuickAction('background')" class="px-2 py-1 bg-green-100 hover:bg-green-200 rounded text-xs flex items-center gap-1">
            <span>ğŸ–¼</span>èƒŒæ™¯ç”»åƒä½œæˆ
          </button>
        </div>

        <button onclick="addComment()" class="w-full mt-3 bg-teal-500 hover:bg-teal-600 text-white py-2 rounded font-medium">è¿½åŠ </button>
      </div>

      <!-- ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ -->
      <div class="p-4 border-t border-gray-200 flex-1 overflow-auto">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-medium text-gray-700">ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§</span>
          <span id="commentCount" class="bg-teal-500 text-white text-xs px-2 py-0.5 rounded-full">0</span>
        </div>
        <div id="commentList" class="space-y-2 text-sm">
          <!-- å…¨ã‚³ãƒ¡ãƒ³ãƒˆãƒªã‚¹ãƒˆ -->
        </div>
      </div>

      <!-- ãƒ•ãƒƒã‚¿ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="p-3 border-t border-gray-200 flex items-center justify-between bg-gray-50">
        <button onclick="copyJSON()" class="text-xs text-gray-600 hover:text-gray-800 flex items-center gap-1">
          <span>ğŸ“‹</span>JSON<br>ã‚³ãƒ”ãƒ¼
        </button>
        <button onclick="clearAllComments()" class="text-xs text-gray-600 hover:text-red-600 flex items-center gap-1">
          <span>ğŸ—‘</span>å…¨å‰Šé™¤
        </button>
        <button onclick="toggleCommentPanel()" class="text-xs text-gray-600 hover:text-gray-800">Ã— é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="layoutModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg w-[900px] max-h-[80vh] overflow-hidden">
      <div class="p-4 border-b border-gray-200 flex items-center justify-between">
        <h3 class="font-bold text-lg">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ</h3>
        <button onclick="closeLayoutModal()" class="text-gray-500 hover:text-gray-700 text-xl">Ã—</button>
      </div>
      <div id="layoutPatterns" class="p-4 overflow-auto max-h-[60vh]">
        <!-- ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>
    </div>
  </div>

  <script>
    // çŠ¶æ…‹ç®¡ç†
    let currentSlide = 1;      // Markdownãƒ•ã‚¡ã‚¤ãƒ«å†…ã®å®Ÿéš›ã®ã‚¹ãƒ©ã‚¤ãƒ‰ç•ªå·ï¼ˆ1ãƒ™ãƒ¼ã‚¹ï¼‰
    let totalSlides = 1;       // åˆæœŸå€¤ã¯1ã€å¾Œã§Marpã‹ã‚‰å–å¾—
    let pageOffset = 0;        // _paginate: falseã®ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ï¼ˆãƒšãƒ¼ã‚¸ç•ªå·ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼‰
    let comments = {};
    let currentSlideFile = 'example.md';

    // Marpã‚µãƒ¼ãƒãƒ¼ã®ãƒ™ãƒ¼ã‚¹ URLï¼ˆãƒ—ãƒ­ã‚­ã‚·çµŒç”±ï¼‰
    const MARP_BASE_URL = '/marp';

    // Marpã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ç·æ•°ã¨ãƒšãƒ¼ã‚¸ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å–å¾—
    async function fetchTotalSlides() {
      try {
        const response = await fetch(`${MARP_BASE_URL}/${currentSlideFile}`);
        const html = await response.text();
        // Marpã®HTMLã§ã¯å„ã‚¹ãƒ©ã‚¤ãƒ‰ãŒ<section>ã‚¿ã‚°ã§å›²ã¾ã‚Œã¦ã„ã‚‹
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const sections = doc.querySelectorAll('section');
        if (sections.length > 0) {
          totalSlides = sections.length;

          // _paginate: falseã®ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆï¼ˆãƒšãƒ¼ã‚¸ç•ªå·ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼‰
          // data-marpit-paginationå±æ€§ãŒãªã„sectionãŒpaginate: falseã®ã‚¹ãƒ©ã‚¤ãƒ‰
          let offset = 0;
          sections.forEach((section, index) => {
            // ãƒšãƒ¼ã‚¸ç•ªå·ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            // æœ€åˆã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚ˆã‚Šå‰ã«ã‚ã‚‹paginate:falseã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ
            if (!section.hasAttribute('data-marpit-pagination') && index < sections.length - 1) {
              // å…ˆé ­ã‹ã‚‰é€£ç¶šã™ã‚‹paginate:falseã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
              if (index === offset) {
                offset++;
              }
            }
          });
          pageOffset = offset;
          console.log(`Total slides: ${totalSlides}, Page offset: ${pageOffset}`);
        }
        updateSlideCounter();
      } catch (e) {
        console.error('ã‚¹ãƒ©ã‚¤ãƒ‰ç·æ•°ã®å–å¾—ã«å¤±æ•—:', e);
      }
    }

    // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
    function updateSlideCounter() {
      // ã€Œã‚¹ãƒ©ã‚¤ãƒ‰ X / Yã€å½¢å¼ã§è¡¨ç¤ºï¼ˆMarpã®ãƒšãƒ¼ã‚¸ç•ªå·ã§ã¯ãªãMarkdownãƒ•ã‚¡ã‚¤ãƒ«å†…ã®é€£ç•ªï¼‰
      document.getElementById('slideCounter').textContent = `ã‚¹ãƒ©ã‚¤ãƒ‰ ${currentSlide} / ${totalSlides}`;
      document.getElementById('slideTitle').textContent = `ã‚¹ãƒ©ã‚¤ãƒ‰ ${currentSlide}`;
    }

    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆSVGã‚µãƒ ãƒã‚¤ãƒ«ä»˜ãï¼‰
    const layoutPatterns = {
      'A. ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç³»': [
        { id: 1, name: 'ã‚¿ã‚¤ãƒˆãƒ«ã‚¹ãƒ©ã‚¤ãƒ‰', desc: 'ãƒ—ãƒ¬ã‚¼ãƒ³ã®è¡¨ç´™', svg: 'layout-01-title.svg' },
        { id: 2, name: 'ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ã‚¹ãƒ©ã‚¤ãƒ‰', desc: 'æ–°ã—ã„ç« ã®å§‹ã¾ã‚Šã‚’å°è±¡ã¥ã‘ã‚‹', svg: 'layout-02-section-start.svg' },
        { id: 3, name: 'ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†ãƒ»ã¾ã¨ã‚', desc: 'ç« ã®è¦ç‚¹ã‚’æ•´ç†ã—ã¦æ¬¡ã¸ã¤ãªã’ã‚‹', svg: 'layout-03-summary.svg' },
        { id: 4, name: 'ç›®æ¬¡ã‚¹ãƒ©ã‚¤ãƒ‰', desc: 'è¬›æ¼”å…¨ä½“ã®æ§‹æˆã‚’ç¤ºã™', svg: 'layout-04-toc.svg' },
        { id: 5, name: 'ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ã‚¹ãƒ©ã‚¤ãƒ‰', desc: 'æ„Ÿè¬ã¨é€£çµ¡å…ˆã‚’ä¼ãˆã‚‹', svg: 'layout-05-closing.svg' },
      ],
      'B. ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç³»': [
        { id: 6, name: '2ã‚«ãƒ©ãƒ æ¯”è¼ƒï¼ˆBefore/Afterï¼‰', desc: 'å¤‰åŒ–ã‚’å·¦å³ã§å¯¾æ¯”ã•ã›ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³', svg: 'layout-06-two-col-compare.svg' },
        { id: 7, name: '2ã‚«ãƒ©ãƒ ï¼ˆãƒ†ã‚­ã‚¹ãƒˆ+ç”»åƒï¼‰', desc: 'ãƒ†ã‚­ã‚¹ãƒˆã¨ç”»åƒã‚’æ¨ªä¸¦ã³ã«é…ç½®', svg: 'layout-07-text-image.svg' },
        { id: '7b', name: '2ã‚«ãƒ©ãƒ ï¼ˆç”»åƒ+ãƒ†ã‚­ã‚¹ãƒˆï¼‰', desc: 'ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¨ªä¸¦ã³ã«é…ç½®ï¼ˆé€†ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰', svg: 'layout-07b-image-text.svg' },
        { id: 8, name: '3ã‚«ãƒ©ãƒ ï¼ˆç”»åƒ+ãƒ†ã‚­ã‚¹ãƒˆï¼‰', desc: 'å·¦ç”»åƒã€å³2åˆ—ãƒ†ã‚­ã‚¹ãƒˆ', svg: 'layout-08-three-col-image.svg' },
        { id: '8b', name: '3ã‚«ãƒ©ãƒ å‡ç­‰', desc: '3ã¤ã®æ¦‚å¿µã‚’å‡ç­‰ã«ä¸¦ã¹ã‚‹', svg: 'layout-08b-three-col-equal.svg' },
      ],
      'C. æ•°å€¤ãƒ»çµ±è¨ˆç³»': [
        { id: 9, name: '3ã‚«ãƒ©ãƒ çµ±è¨ˆ', desc: '3ã¤ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å¼·èª¿', svg: 'layout-09-stats-three.svg' },
        { id: 10, name: '4ã‚«ãƒ©ãƒ çµ±è¨ˆ', desc: '4ã¤ã®KPIã‚’ä¸¦åˆ—è¡¨ç¤º', svg: 'layout-10-stats-four.svg' },
        { id: 22, name: 'å¤§ããªæ•°å­—', desc: 'ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹æ•°å€¤è¡¨ç¤º', svg: 'layout-22-big-number.svg' },
      ],
      'D. å¼•ç”¨ãƒ»ã‚³ãƒ¼ãƒ‰ç³»': [
        { id: 11, name: 'å¼•ç”¨ãƒ‘ãƒãƒ«', desc: 'åè¨€ã‚„å‚è€ƒæ–‡çŒ®ã‚’å¼•ç”¨', svg: 'layout-11-quote.svg' },
        { id: 12, name: 'ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯', desc: 'ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º', svg: 'layout-12-code.svg' },
        { id: 13, name: 'ã‚³ãƒ¼ãƒ‰+èª¬æ˜', desc: 'ã‚³ãƒ¼ãƒ‰ã¨è§£èª¬ã®2ã‚«ãƒ©ãƒ ', svg: 'layout-13-code-explain.svg' },
      ],
      'E. ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ãƒ•ãƒ­ãƒ¼ç³»': [
        { id: 14, name: 'ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³', desc: 'çµŒæ­´ã‚„æ­´å²ã‚’è¡¨ç¤º', svg: 'layout-14-timeline.svg' },
        { id: 15, name: 'ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º', desc: 'æ‰‹é †ã‚„ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¬æ˜', svg: 'layout-15-steps.svg' },
        { id: 16, name: 'ãƒ•ãƒ­ãƒ¼å›³ï¼ˆæ¨ªï¼‰', desc: 'ãƒ—ãƒ­ã‚»ã‚¹ã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼', svg: 'layout-16-flow.svg' },
      ],
      'F. ãƒªã‚¹ãƒˆãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ç³»': [
        { id: 17, name: 'ãƒ†ãƒ¼ãƒ–ãƒ«', desc: 'ãƒ‡ãƒ¼ã‚¿ã®æ¯”è¼ƒã‚„ä¸€è¦§', svg: 'layout-17-table.svg' },
        { id: 18, name: 'ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒªã‚¹ãƒˆ', desc: 'æ©Ÿèƒ½ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç´¹ä»‹', svg: 'layout-18-list-icons.svg' },
        { id: 19, name: 'Pros/Consæ¯”è¼ƒ', desc: 'ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ', svg: 'layout-19-proscons.svg' },
        { id: 26, name: 'ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ', desc: 'To-Doã‚„é€²æ—ã‚’è¡¨ç¤º', svg: 'layout-26-checklist.svg' },
      ],
      'G. ç”»åƒãƒ»èƒŒæ™¯ç³»': [
        { id: 20, name: 'å…¨ç”»é¢ç”»åƒ', desc: 'ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«', svg: 'layout-20-fullscreen-image.svg' },
        { id: 21, name: 'åˆ†å‰²ï¼ˆç”»åƒ+ãƒ†ã‚­ã‚¹ãƒˆï¼‰', desc: 'å·¦å³50%åˆ†å‰²', svg: 'layout-21-split-image.svg' },
        { id: 24, name: 'ãƒ‡ãƒ¢ç”»é¢', desc: 'ãƒ–ãƒ©ã‚¦ã‚¶é¢¨ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—', svg: 'layout-24-demo.svg' },
      ],
      'H. å¼·èª¿ãƒ»ç‰¹æ®Šç³»': [
        { id: 23, name: 'å•ã„ã‹ã‘ã‚¹ãƒ©ã‚¤ãƒ‰', desc: 'ä¸»é¡Œã®æç¤ºã‚„å•ã„ã‹ã‘', svg: 'layout-23-question.svg' },
        { id: 25, name: 'ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹', desc: 'é‡è¦ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¼·èª¿', svg: 'layout-25-highlight-box.svg' },
        { id: 27, name: 'ã‚¢ã‚¤ã‚³ãƒ³ã‚°ãƒªãƒƒãƒ‰', desc: '6ã¤ã®é …ç›®ã‚’æ•´ç†', svg: 'layout-27-icons-grid.svg' },
        { id: 28, name: 'ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ', desc: 'ä¸­å¤®ãƒãƒ¼ãƒ‰+æ¥ç¶š', svg: 'layout-28-diagram.svg' },
        { id: 29, name: 'é€²æ—ã‚¢ã‚¸ã‚§ãƒ³ãƒ€', desc: 'ç¾åœ¨ã®é€²è¡Œä½ç½®ã‚’è¡¨ç¤º', svg: 'layout-29-agenda-progress.svg' },
        { id: 30, name: 'Q&Aã‚¹ãƒ©ã‚¤ãƒ‰', desc: 'è³ªç–‘å¿œç­”ã¸ã®èª˜å°', svg: 'layout-30-qna.svg' },
      ],
    };

    // ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©
    const quickActions = {
      style: '/slide-style-rector ã‚’ã¤ã‹ã£ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ•´ãˆã‚‹',
      layout: '/layout-fix ã‚’ã¤ã‹ã£ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œã‚’ä¿®æ­£ã—ã¦',
      illustration: '/ergon ã‚’ã¤ã‹ã£ã¦èª¬æ˜ã‚¤ãƒ©ã‚¹ãƒˆã‚’ä½œæˆã—ã¦æŒ¿å…¥ã—ã¦',
      background: '/ergon ã‚’ã¤ã‹ã£ã¦èƒŒæ™¯ç”»åƒã‚’ä½œæˆã—ã¦æŒ¿å…¥ã—ã¦',
    };

    // åˆæœŸåŒ–
    async function init() {
      loadComments();
      await fetchTotalSlides();  // ã‚¹ãƒ©ã‚¤ãƒ‰ç·æ•°ã‚’å–å¾—
      updateSlideFrame();
      renderLayoutPatterns();

      // iframeã®loadã‚¤ãƒ™ãƒ³ãƒˆã§ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±ã‚’æ›´æ–°
      document.getElementById('slideFrame').addEventListener('load', () => {
        updateSlideCounter();
        renderCurrentSlideComments();
      });

      document.getElementById('slideSelect').addEventListener('change', async (e) => {
        currentSlideFile = e.target.value;
        currentSlide = 1;
        loadComments();  // ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’å†èª­ã¿è¾¼ã¿
        await fetchTotalSlides();  // æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ãƒ©ã‚¤ãƒ‰ç·æ•°ã‚’å–å¾—
        updateSlideFrame();
      });
    }

    // Marpãƒšãƒ¼ã‚¸ç•ªå·ã‚’è¨ˆç®—ï¼ˆpaginate:falseã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è€ƒæ…®ï¼‰
    function getMarpPageNum(slideNum) {
      return slideNum <= pageOffset ? slideNum : slideNum - pageOffset;
    }

    // ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ æ›´æ–°
    function updateSlideFrame() {
      const frame = document.getElementById('slideFrame');
      frame.src = `${MARP_BASE_URL}/${currentSlideFile}#${getMarpPageNum(currentSlide)}`;
      updateSlideCounter();
      renderCurrentSlideComments();
    }

    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
    function navigateSlide(delta) {
      const newSlide = currentSlide + delta;
      if (newSlide >= 1 && newSlide <= totalSlides) {
        currentSlide = newSlide;
        updateSlideFrame();
      }
    }

    function prevSlide() { navigateSlide(-1); }
    function nextSlide() { navigateSlide(1); }

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;
      if (e.key === 'ArrowLeft') prevSlide();
      if (e.key === 'ArrowRight') nextSlide();
    });

    // ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
    function addComment() {
      const textarea = document.getElementById('newComment');
      const text = textarea.value.trim();
      if (!text) return;

      if (!comments[currentSlide]) {
        comments[currentSlide] = [];
      }
      comments[currentSlide].push(text);
      textarea.value = '';
      saveComments();
      renderCurrentSlideComments();
      renderCommentList();
    }

    // ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æŒ¿å…¥
    function insertQuickAction(type) {
      const textarea = document.getElementById('newComment');
      const action = quickActions[type];
      textarea.value = textarea.value ? textarea.value + '\n' + action : action;
      textarea.focus();
    }

    // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
    function renderCurrentSlideComments() {
      const container = document.getElementById('currentSlideComments');
      const slideComments = comments[currentSlide] || [];

      if (slideComments.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-sm">ã“ã“ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ </p>';
        return;
      }

      container.innerHTML = slideComments.map((comment, idx) => `
        <div class="bg-gray-50 p-2 rounded text-sm flex items-start justify-between group">
          <span class="flex-1">${escapeHtml(comment)}</span>
          <button onclick="deleteComment(${currentSlide}, ${idx})" class="text-gray-400 hover:text-red-500 ml-2 opacity-0 group-hover:opacity-100">Ã—</button>
        </div>
      `).join('');
    }

    // ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
    function renderCommentList() {
      const container = document.getElementById('commentList');
      const allComments = [];

      Object.entries(comments).forEach(([slide, slideComments]) => {
        slideComments.forEach((comment, idx) => {
          allComments.push({ slide: parseInt(slide), comment, idx });
        });
      });

      document.getElementById('commentCount').textContent = allComments.length;

      if (allComments.length === 0) {
        container.innerHTML = '<p class="text-gray-400">ã‚³ãƒ¡ãƒ³ãƒˆãªã—</p>';
        return;
      }

      container.innerHTML = allComments.map(({ slide, comment }) => `
        <div class="bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100" onclick="goToSlide(${slide})">
          <div class="flex items-center justify-between">
            <span class="font-medium text-gray-700">ã‚¹ãƒ©ã‚¤ãƒ‰ ${slide}</span>
          </div>
          <p class="text-gray-600 text-xs mt-1 truncate">${escapeHtml(comment)}</p>
        </div>
      `).join('');
    }

    // ã‚¹ãƒ©ã‚¤ãƒ‰ã¸ç§»å‹•
    function goToSlide(slide) {
      currentSlide = slide;
      updateSlideFrame();
    }

    // ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤
    function deleteComment(slide, idx) {
      comments[slide].splice(idx, 1);
      if (comments[slide].length === 0) {
        delete comments[slide];
      }
      saveComments();
      renderCurrentSlideComments();
      renderCommentList();
    }

    // å…¨å‰Šé™¤
    function clearAllComments() {
      if (confirm('ã™ã¹ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        comments = {};
        saveComments();
        renderCurrentSlideComments();
        renderCommentList();
      }
    }

    // JSONå‡ºåŠ›
    function copyJSON() {
      const output = {
        file: `slides/${currentSlideFile}`,
        timestamp: new Date().toISOString(),
        feedback: Object.entries(comments).map(([slide, slideComments]) => ({
          slide: parseInt(slide),
          comments: slideComments
        }))
      };

      navigator.clipboard.writeText(JSON.stringify(output, null, 2));
      alert('JSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    }

    // LocalStorage
    function saveComments() {
      localStorage.setItem(`feedback_${currentSlideFile}`, JSON.stringify(comments));
    }

    function loadComments() {
      const saved = localStorage.getItem(`feedback_${currentSlideFile}`);
      comments = saved ? JSON.parse(saved) : {};
      renderCommentList();
    }

    // ãƒ‘ãƒãƒ«è¡¨ç¤ºåˆ‡æ›¿
    function toggleCommentPanel() {
      const panel = document.getElementById('commentPanel');
      panel.classList.toggle('hidden');
    }

    // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
    function toggleFullscreen() {
      const frame = document.getElementById('slideFrame');
      if (frame.requestFullscreen) {
        frame.requestFullscreen();
      }
    }

    // æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
    function openInNewTab() {
      window.open(`${MARP_BASE_URL}/${currentSlideFile}#${getMarpPageNum(currentSlide)}`, '_blank');
    }

    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«
    function setLayoutModalVisible(visible) {
      const modal = document.getElementById('layoutModal');
      modal.classList.toggle('hidden', !visible);
      modal.classList.toggle('flex', visible);
    }

    function openLayoutModal() { setLayoutModalVisible(true); }
    function closeLayoutModal() { setLayoutModalVisible(false); }

    function selectLayout(id, name) {
      const textarea = document.getElementById('newComment');
      const prompt = `ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³${id}: ${name}ã€ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å¤‰æ›´ã—ã¦`;
      textarea.value = textarea.value ? textarea.value + '\n' + prompt : prompt;
      closeLayoutModal();
      textarea.focus();
    }

    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤ºï¼ˆSVGã‚µãƒ ãƒã‚¤ãƒ«ä½¿ç”¨ï¼‰
    function renderLayoutPatterns() {
      const container = document.getElementById('layoutPatterns');

      const renderPattern = (p) => `
        <div class="pattern-card border border-gray-200 rounded-lg overflow-hidden cursor-pointer transition-all hover:border-teal-500 hover:shadow-md"
             onclick="selectLayout('${p.id}', '${p.name}')">
          <div class="bg-gray-50 p-2 flex items-center justify-center" style="height: 100px;">
            <img src="svg/${p.svg}" alt="${p.name}" class="w-full h-full object-contain" />
          </div>
          <div class="p-2 bg-white border-t border-gray-100">
            <div class="text-xs text-teal-600 font-medium">${p.id}</div>
            <div class="text-sm font-bold text-gray-800">${p.name}</div>
            <div class="text-xs text-gray-500 mt-0.5">${p.desc}</div>
          </div>
        </div>`;

      const renderCategory = ([category, patterns]) => `
        <h4 class="font-bold text-gray-700 mt-6 mb-3 first:mt-0">${category}</h4>
        <div class="grid grid-cols-3 gap-4">${patterns.map(renderPattern).join('')}</div>`;

      container.innerHTML = Object.entries(layoutPatterns).map(renderCategory).join('');
    }

    // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // åˆæœŸåŒ–å®Ÿè¡Œ
    init();
  </script>
</body>
</html>
